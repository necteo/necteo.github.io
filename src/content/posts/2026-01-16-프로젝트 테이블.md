---
title: '프로젝트 테이블'
published: 2026-01-16
description: '테이블 공유용'
pinned: false
author: 'necteo'
image: ''
tags: ['Oracle', 'SQL']
category: 'SQL'
draft: true
---

그냥 원격 공유용이다

```sql
-- 식품 별 분류
CREATE TABLE product_category (
    category_id     NUMBER,
    category_name   VARCHAR2(100) NOT NULL,  -- 팝콘/탄산/스낵
    CONSTRAINT pc_id_pk PRIMARY KEY(category_id),
    CONSTRAINT pc_name_uk UNIQUE(category_name)
);

CREATE TABLE product_item_category (
    item_category_id    NUMBER,
    item_id             NUMBER,
    category_id         NUMBER,
    CONSTRAINT pic_id_pk PRIMARY KEY(item_category_id),
    CONSTRAINT pic_iid_fk FOREIGN KEY(item_id) REFERENCES product_item(item_id),
    CONSTRAINT pic_cid_fk FOREIGN KEY(category_id) REFERENCES product_category(category_id)
);

-- 모든 식품 => 옵션에서 고를 수 있는 식품들
CREATE TABLE product_item (
    item_id     NUMBER,
    item_name   VARCHAR2(100) NOT NULL, -- 고소팝콘/셀프탄산
--    category_id NUMBER,
    item_size   VARCHAR2(5), -- M/L
    item_price  NUMBER NOT NULL,    -- 기본 식품 가격
    base_item_id    NUMBER,  -- NULL: 기본, 값: 옵션
    add_price       NUMBER DEFAULT 0,   -- 옵션 추가금액
    item_regdate     DATE DEFAULT SYSDATE,
    item_moddate     DATE,
    CONSTRAINT pi_id_pk PRIMARY KEY(item_id),
    CONSTRAINT pi_cid_fk FOREIGN KEY(category_id) REFERENCES product_category(category_id),
    CONSTRAINT pi_bid_fk FOREIGN KEY(base_item_id) REFERENCES product_item(item_id),
    CONSTRAINT pi_size_ck CHECK(item_size IN ('M', 'L')),
    CONSTRAINT pi_price_ck CHECK(item_price >= 0),
    CONSTRAINT pi_add_ck CHECK(add_price >= 0),
    CONSTRAINT pi_logic_ck CHECK(
        (base_item_id IS NULL AND add_price = 0) OR -- 기본식품은 추가금액 0
        (base_item_id IS NOT NULL)  -- 옵션식품은 기본식품 참조
    )
);
ALTER TABLE product_item DROP CONSTRAINT pi_cid_fk;
ALTER TABLE product_item DROP COLUMN category_id;
CREATE INDEX idx_pi_category ON product_item(category_id);
CREATE INDEX idx_pi_base ON product_item(base_item_id);

-- 모든 상품 => 목록 출력용
CREATE TABLE store_product (
    product_id      NUMBER,
    product_name    VARCHAR2(100) NOT NULL,
    product_image   VARCHAR2(200),
    item_id         NUMBER,     -- 단품: 기본, 콤보: NULL
    product_price   NUMBER DEFAULT 0,   -- 기본금액
    discount        NUMBER DEFAULT 0,   -- 할인금액 (콤보)
    description     VARCHAR2(500) NOT NULL,
    is_combo        VARCHAR2(1) DEFAULT 'N', -- N: 단품/Y: 콤보
    CONSTRAINT sp_id_pk PRIMARY KEY(product_id),
    CONSTRAINT sp_iid_fk FOREIGN KEY(item_id) REFERENCES product_item(item_id),
    CONSTRAINT sp_combo_ck CHECK(is_combo IN ('Y', 'N')),
    CONSTRAINT sp_base_ck CHECK(product_price >= 0),
    CONSTRAINT sp_discount_ck CHECK(discount >= 0),
    CONSTRAINT sp_logic_ck CHECK(
        (is_combo = 'N' AND item_id IS NOT NULL) OR -- 단품은 item_id 필수
        (is_combo = 'Y' AND item_id IS NULL)    -- 콤보는 NULL
    )
);

CREATE INDEX idx_sp_item ON store_product(item_id);
CREATE INDEX idx_sp_combo ON store_product(is_combo);

-- 콤보 구성
CREATE TABLE product_combo (
    combo_id      NUMBER,
    product_id  NUMBER,
    item_id     NUMBER,     -- 기본 설정 식품
    is_upgrade  VARCHAR2(1) DEFAULT 'Y',    -- 사이즈 업그레이드 가능여부
    upgrade_price   NUMBER DEFAULT 0,   -- M => L 추가금액
    item_quantity    NUMBER DEFAULT 1,
    CONSTRAINT pcmb_id_pk PRIMARY KEY(combo_id),
    CONSTRAINT pcmb_pid_fk FOREIGN KEY(product_id) REFERENCES store_product(product_id),
    CONSTRAINT pcmb_iid_fk FOREIGN KEY(item_id) REFERENCES product_item(item_id),
    CONSTRAINT pcmb_upgrade_ck CHECK(is_upgrade IN ('Y', 'N')),
    CONSTRAINT pcmb_uprice_ck CHECK(upgrade_price >= 0),
    CONSTRAINT pcmb_quantity_ck CHECK(item_quantity > 0)
);

CREATE INDEX idx_pcmb_product ON product_combo(product_id);

-- 매점
CREATE TABLE store (
    store_id    NUMBER,
    theater_id  VARCHAR2(4) NOT NULL,
    store_name  VARCHAR2(50) NOT NULL,
    userid      VARCHAR2(20),
    CONSTRAINT st_id_pk PRIMARY KEY(store_id),
    CONSTRAINT st_tid_fk FOREIGN KEY(theater_id) REFERENCES theater(theater_id),
    CONSTRAINT st_uid_fk FOREIGN KEY(userid) REFERENCES member(userid)
);
drop table store;
truncate table store;
INSERT INTO store (store_id, theater_id, store_name)
SELECT
    seq_store_id.nextval, -- 시퀀스도 SELECT 절에서 바로 사용 가능합니다.
    theater_id,
    theater_name || '점'   -- 기존 영화관 이름 뒤에 '점'을 붙여서 store_name으로 삽입
FROM theater;
commit;

-- 재고
CREATE TABLE store_stock (
    stock_id    NUMBER,
    store_id    NUMBER,
    product_id  NUMBER,
    stock_quantity    NUMBER DEFAULT 0,
    stock_regdate     DATE DEFAULT SYSDATE,
    stock_moddate     DATE,
    CONSTRAINT ss_id_pk PRIMARY KEY(stock_id),
    CONSTRAINT ss_sid_fk FOREIGN KEY(store_id) REFERENCES store(store_id) ON DELETE CASCADE,
    CONSTRAINT ss_pid_fk FOREIGN KEY(product_id) REFERENCES store_product(product_id),
    CONSTRAINT ss_qty_ck CHECK(stock_quantity >= 0),
    CONSTRAINT ss_id_uk UNIQUE(store_id, product_id)
);
drop table store_stock;

-- 결제 정보
CREATE TABLE payment (
    payment_id      NUMBER,
    userid          VARCHAR2(50) NOT NULL,
    merchant_uid    VARCHAR2(100) NOT NULL UNIQUE,
    imp_uid         VARCHAR2(100),
    amount          NUMBER NOT NULL,
    payment_method  VARCHAR2(20),
    payment_status  VARCHAR2(20) DEFAULT 'ready',
    buyer_name      VARCHAR2(100),
    buyer_tel       VARCHAR2(20),
    buyer_email     VARCHAR2(100),
    payment_date    DATE,
    regdate         DATE DEFAULT SYSDATE,
    CONSTRAINT payment_id_pk PRIMARY KEY(payment_id),
    CONSTRAINT payment_uid_fk FOREIGN KEY(userid) REFERENCES member(userid)
);

-- 주문 정보
CREATE TABLE orders (
    order_id        NUMBER,
    userid          VARCHAR2(50) NOT NULL,
    store_id        NUMBER NOT NULL,
    merchant_uid    VARCHAR2(100) NOT NULL,
    total_amount    NUMBER NOT NULL,
    order_status    VARCHAR2(20) DEFAULT 'received', -- received, rejected, preparing, ready, cancelled, completed
    order_date      DATE DEFAULT SYSDATE,
    regdate         DATE DEFAULT SYSDATE,
    CONSTRAINT order_id_pk PRIMARY KEY(order_id),
    CONSTRAINT order_uid_fk FOREIGN KEY(userid) REFERENCES member(userid),
    CONSTRAINT order_sid_fk FOREIGN KEY(store_id) REFERENCES store(store_id),
    CONSTRAINT order_mid_fk FOREIGN KEY(merchant_uid) REFERENCES payment(merchant_uid),
    CONSTRAINT order_status_ck CHECK(order_status IN ('received', 'rejected', 'preparing', 'ready', 'cancelled', 'completed'))
);
drop table order_item_detail;
drop table order_item;
drop table orders;
-- 주문 상품
CREATE TABLE order_item (
    order_item_id   NUMBER,
    order_id        NUMBER NOT NULL,
    product_id      NUMBER NOT NULL,
    quantity        NUMBER NOT NULL,
    price           NUMBER NOT NULL,
    CONSTRAINT oi_id_pk PRIMARY KEY(order_item_id),
    CONSTRAINT oi_oid_fk FOREIGN KEY(order_id) REFERENCES orders(order_id) ON DELETE CASCADE,
    CONSTRAINT oi_pid_fk FOREIGN KEY(product_id) REFERENCES store_product(product_id)
);

-- 주문 상품 상세 (옵션)
CREATE TABLE order_item_detail (
    order_item_detail_id    NUMBER,
    order_item_id           NUMBER NOT NULL,
    item_id                 NUMBER NOT NULL,
    quantity                NUMBER NOT NULL,
    CONSTRAINT oid_id_pk PRIMARY KEY(order_item_detail_id),
    CONSTRAINT oid_oiid_fk FOREIGN KEY(order_item_id) REFERENCES order_item(order_item_id) ON DELETE CASCADE,
    CONSTRAINT oid_iid_fk FOREIGN KEY(item_id) REFERENCES product_item(item_id)
);

-- 시퀀스
CREATE SEQUENCE seq_payment_id START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_order_id START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_order_item_id START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_order_item_detail_id START WITH 1 INCREMENT BY 1;

-- 장바구니
CREATE TABLE cart (
    cart_id     NUMBER,
    userid      VARCHAR2(20) NOT NULL,
    store_id    NUMBER NOT NULL,
    product_id  NUMBER NOT NULL,
    quantity    NUMBER DEFAULT 1,
    cart_regdate     DATE DEFAULT SYSDATE,
    CONSTRAINT cart_id_pk PRIMARY KEY(cart_id),
    CONSTRAINT cart_uid_fk FOREIGN KEY(userid) REFERENCES member(userid),
    CONSTRAINT cart_sid_fk FOREIGN KEY(store_id) REFERENCES store(store_id),
    CONSTRAINT cart_pid_fk FOREIGN KEY(product_id) REFERENCES store_product(product_id),
    CONSTRAINT cart_qty_ck CHECK(quantity > 0)
);
drop table cart;
-- 장바구니 식품
CREATE TABLE cart_item (
    cart_item_id    NUMBER,
    cart_id         NUMBER NOT NULL,
    item_id         NUMBER NOT NULL,
    quantity        NUMBER DEFAULT 1,
    CONSTRAINT ci_id_pk PRIMARY KEY(cart_item_id),
    CONSTRAINT ci_cid_fk FOREIGN KEY(cart_id) REFERENCES cart(cart_id) ON DELETE CASCADE,
    CONSTRAINT ci_iid_fk FOREIGN KEY(item_id) REFERENCES product_item(item_id),
    CONSTRAINT ci_qty_ck CHECK(quantity > 0)
);
drop table cart_item;
CREATE SEQUENCE seq_category_id START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE seq_item_category_id START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE seq_item_id START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE seq_product_id START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE seq_combo_id START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE seq_theater_id START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE seq_store_id START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE seq_stock_id START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE seq_order_id START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE seq_order_product_id START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE seq_order_item_id START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE seq_cart_id START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE seq_cart_item_id START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

INSERT INTO product_category VALUES(1, '팝콘');
INSERT INTO product_category VALUES(2, '음료');
INSERT INTO product_category VALUES(3, '탄산');
INSERT INTO product_category VALUES(4, '스낵');
commit;

INSERT INTO product_item(item_id, item_name, item_size, item_price, base_item_id) VALUES(seq_item_id.nextval, '고소팝콘', 'M', 5500, null); -- add_price
INSERT INTO product_item(item_id, item_name, item_size, item_price, base_item_id, add_price) VALUES(seq_item_id.nextval, '달콤팝콘', 'M', 5500, 1, 1000);

INSERT INTO product_item_category(item_category_id, item_id, category_id) VALUES(seq_item_category_id.nextval, 1, 1);
INSERT INTO product_item_category(item_category_id, item_id, category_id) VALUES(seq_item_category_id.nextval, 2, 1);

INSERT INTO store_product(product_id, product_name, product_image, item_id, product_price, discount, description, is_combo)
VALUES(seq_product_id.nextval, '팝콘', '/img/popcorn_m.png', 1, 5500, 0, '팝콘(M)', N);

truncate table cart_item;
truncate table cart;
truncate table order_item_detail;
truncate table order_item;
truncate table orders;
truncate table payment;
truncate table store_stock;
truncate table product_combo;
truncate table store_product;
truncate table product_item_category;
truncate table product_item;
```
